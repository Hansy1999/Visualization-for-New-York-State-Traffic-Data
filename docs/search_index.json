[["missing-values.html", "Chapter 4 Missing values", " Chapter 4 Missing values library(tidyverse) library(patchwork) We will first make a visna plot for the transformed dataset, which provides a good first overview of the missing values: create_missing_plots&lt;-function(df, percent, max_patterns=Inf){ missing_patterns &lt;- data.frame(is.na(df)) %&gt;% group_by_all() %&gt;% count(name = &quot;count&quot;, sort = TRUE) %&gt;% ungroup() if(nrow(missing_patterns)&gt;max_patterns){ missing_patterns&lt;-missing_patterns%&gt;%top_n(max_patterns) } missing_patterns_with_ID&lt;-missing_patterns%&gt;%rowid_to_column(&quot;ID&quot;) column_names&lt;-head(as.vector(colnames(missing_patterns)),-1) missing_patterns_with_ID$ID &lt;-fct_rev(factor(missing_patterns_with_ID$ID)) missing_patterns_with_ID$ID&lt;-fct_reorder(missing_patterns_with_ID$ID, missing_patterns$count) missing_patterns_with_ID$with_NA&lt;-ifelse(rowSums(missing_patterns_with_ID[column_names] == TRUE) == 0, TRUE, FALSE) id_with_no_na=NA for (id in missing_patterns_with_ID$ID){ if((missing_patterns_with_ID%&gt;%filter(ID==id))$with_NA==TRUE){ id_with_no_na=id } } missing_patterns_longer&lt;-missing_patterns_with_ID%&gt;% pivot_longer(cols=!c(ID,count,with_NA), names_to = &#39;Variable&#39;, values_to=&#39;If_NOT_NA&#39;) missing_patterns_longer$Variable&lt;-fct_inorder(missing_patterns_longer$Variable) if(percent){ missing_patterns_var_count&lt;-missing_patterns_longer%&gt;% group_by(Variable)%&gt;% summarize(var_count=100*sum(count[If_NOT_NA==TRUE])/sum(count)) missing_patterns_with_ID&lt;-missing_patterns_with_ID%&gt;% mutate(new_count=100*count/sum(count)) missing_patterns_with_ID$count&lt;-missing_patterns_with_ID$new_count } else{ missing_patterns_var_count&lt;-missing_patterns_longer%&gt;% group_by(Variable)%&gt;% summarize(var_count=sum(count[If_NOT_NA==TRUE]))%&gt;% ungroup() } missing_patterns_var_count$Variable&lt;-fct_rev(fct_reorder(fct_rev(missing_patterns_var_count$Variable) ,missing_patterns_var_count$var_count)) p_main&lt;-ggplot(missing_patterns_longer,aes(x=fct_relevel(Variable,levels=levels(missing_patterns_var_count$Variable)), y=ID, fill=If_NOT_NA, alpha=with_NA))+ geom_tile(color = &quot;white&quot;)+ scale_fill_manual(values=c(&quot;TRUE&quot;=&quot;purple&quot;,&quot;FALSE&quot;=&quot;darkgrey&quot;))+ scale_alpha_manual(values=c(&quot;TRUE&quot;=1.0,&quot;FALSE&quot;=0.5))+ theme_classic()+ theme(legend.position = &quot;none&quot;)+ xlab(&#39;variable&#39;)+ ylab(&#39;missing pattern&#39;) if(!is.na(id_with_no_na)){ p_main&lt;-p_main+annotate(&quot;text&quot;, x = length(column_names)/2, y=id_with_no_na, label = &quot;complete cases&quot;,hjust = 0.3) } p2&lt;-ggplot(missing_patterns_with_ID,aes(x=ID, y=count,alpha=with_NA))+ geom_col(fill=&#39;dodgerblue3&#39;)+ scale_alpha_manual(values=c(&#39;TRUE&#39;=1.0,&quot;FALSE&quot;=0.5))+ coord_flip()+ theme_bw()+ theme(legend.position = &quot;none&quot;, axis.title.y=element_blank(), panel.grid.major.y = element_blank())+ ylab(&#39;row count&#39;) p3&lt;-ggplot(missing_patterns_var_count,aes(x=Variable, y=var_count))+ geom_col(fill=&#39;dodgerblue3&#39;,alpha=0.5)+ ylab(sprintf(&#39;num rows \\n missing:&#39;))+ theme_bw()+ theme(axis.title.x=element_blank(),panel.grid.major.x = element_blank())+ scale_y_continuous(breaks =pretty(missing_patterns_var_count$var_count, n = 3)) if(percent){ p2&lt;-p2+ylab(&#39;% rows&#39;)+ scale_y_continuous(breaks = seq(0, 100, by = 25))+ ylim(0, 100) p3&lt;-p3+ylab(sprintf(&#39;%% rows \\n missing:&#39;))+ scale_y_continuous(breaks = seq(0, 100, by = 25))+ ylim(0, 100) } layout &lt;- &quot; CCCC# AAAAB AAAAB AAAAB AAAAB &quot; p_main+p2+p3+plot_layout(design = layout) } df_final_project&lt;-read_csv(&quot;data/2020.csv&quot;) names(df_final_project) &lt;- abbreviate(names(df_final_project), minlength=3,method = &quot;both.sides&quot;) create_missing_plots(df_final_project,percent=FALSE,max_patterns =15) By investigating the above plot, we found there are a lot of missing data for the average speed of the car per day, so we are considering removing it, as the huge missing of the data would make the result based on it unreliable. We also noticed that the rest of the missing data are mostly from the vehicle count data(count-per-hour) for different periods during a day, so we decided to do more investigation focus on them to understand these missing patterns. Regrading to count-per-hour data, we noticed that most of the missing patterns would have missing data for a continuous-time interval(ex. 7 pm, 8 pm, 9 pm .etc). We suspect that this may be because the data are collected for a continuous hour period (eg. 24/36/48 continuous hours), so the hours without any counting are often continuous. To do more investigation focus on count-per-hour data, we first made a bar plot to check the trend of number of missing value with time. # change dates to YYYY-MM-DD format df_final_project_longer &lt;-df_final_project%&gt;% pivot_longer(cols=c(&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;,&#39;9&#39;,&#39;10&#39;,&#39;11&#39;,&#39;12&#39;,&#39;13&#39;,&#39;14&#39;,&#39;15&#39;,&#39;16&#39;,&#39;17&#39;,&#39;18&#39;,&#39;19&#39;,&#39;20&#39;,&#39;21&#39;,&#39;22&#39;,&#39;23&#39;,&#39;24&#39;),names_to=&quot;Time_Interval&quot;,values_to = &quot;Count&quot;) df_final_project_longer$Time_Interval&lt;-fct_relevel(df_final_project_longer$Time_Interval,c(&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;,&#39;9&#39;,&#39;10&#39;,&#39;11&#39;,&#39;12&#39;,&#39;13&#39;,&#39;14&#39;,&#39;15&#39;,&#39;16&#39;,&#39;17&#39;,&#39;18&#39;,&#39;19&#39;,&#39;20&#39;,&#39;21&#39;,&#39;22&#39;,&#39;23&#39;,&#39;24&#39;)) # calculate number missing by day missing &lt;- df_final_project_longer%&gt;% group_by(Time_Interval) %&gt;% summarise(sum.na = sum(is.na(Count))) # plot number missing by day ggplot(missing, aes(x = 1:24, y = sum.na)) + geom_col(color = &quot;blue&quot;, fill = &quot;lightblue&quot;) + scale_x_continuous(breaks = 1:24, labels = missing$Time_Interval) + ggtitle(&quot;Number of missing values by Time Interval&quot;) + xlab(&quot;Time interval from 1(1am) to 24(12am)&quot;) + ylab(&quot;Number of missing count values (Out of 110535)&quot;) For the count for different time interval, it seems that there are more missing of the data from 7am to 7pm, but the number of missing data does not different by a lot for each time interval. Then we further made the plots showing the missing value for specific time period and date for each count session. Sys.setlocale(&quot;LC_TIME&quot;, &quot;English&quot;) ## [1] &quot;English_United States.1252&quot; df_final_project&lt;-read_csv(&quot;data/2020.csv&quot;) df_final_project &lt;- df_final_project %&gt;% filter(REGION==&#39;11&#39;&amp; COUNTY_CODE==&#39;1&#39;&amp; `MONTH`==&#39;11&#39;)%&gt;% select( `Date`,`COUNT_ID`, `1`:`24`) %&gt;% gather(key, value, -`Date`,-`COUNT_ID`) %&gt;% mutate(missing = ifelse(is.na(value), &quot;yes&quot;, &quot;no&quot;),Date=as.Date(Date)) df_final_project$key&lt;-fct_inorder(df_final_project$key) ggplot(df_final_project, aes(x = key, y = `Date`, fill = missing)) + geom_raster() + scale_fill_manual(values = c(&quot;white&quot;, &quot;red&quot;))+scale_y_date(date_breaks = &quot;1 day&quot;) + theme_bw()+ facet_wrap(vars( COUNT_ID),scales = &quot;free&quot;,ncol=3)+ggtitle(&quot;Missing data for each count session in November, 2020 from New York County in New York city&quot;)+xlab(&#39;Time Period&#39;)+ylab(&#39;Date&#39;) We made many plots as above, and here we use the count session in November 2020 from New York County in New York City as an example. By using the many plots just as the above, we can easily find, for each count session, it counts the volume of cars for continuous hours and it is recorded as a whole day even not all the hours in that day are counted. This leads to the majority of missing data in the dataset as the rest of the hours during the day(red area) are recorded as NA. Also, we indeed found some random missing value that does not follow this pattern, but they are much less frequent. After checking the documentation, there is no explanation for these missing values, so we wound treat them as errors. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
